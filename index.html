<?php
// اتصال به پایگاه داده (db.php)
$host = 'localhost';
$db = 'accessory_shop';
$user = 'root';
$pass = '';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$db", $user, $pass);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch (PDOException $e) {
    echo 'Connection failed: ' . $e->getMessage();
}

// صفحه اصلی (index.php)
if ($_SERVER['REQUEST_URI'] == "/") {
    // دریافت محصولات از دیتابیس
    $stmt = $pdo->query("SELECT * FROM products LIMIT 6");
    $products = $stmt->fetchAll(PDO::FETCH_ASSOC);
    echo '
    <!DOCTYPE html>
    <html lang="fa">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>فروشگاه اکسسوری</title>
        <link href="https://fonts.googleapis.com/css2?family=Shabnam&display=swap" rel="stylesheet">
        <style>
            body { font-family: "Shabnam", sans-serif; background: #111; color: white; margin: 0; padding: 0; }
            header { background: #222; color: white; padding: 20px; text-align: center; }
            .menu { display: flex; justify-content: center; gap: 30px; background: #111; padding: 15px; }
            .menu a { color: white; text-decoration: none; padding: 10px; font-size: 18px; border-radius: 5px; transition: background-color 0.3s ease; }
            .menu a:hover { background-color: #3498db; }
            .product-card { background: #222; padding: 20px; margin: 15px; border-radius: 10px; box-shadow: 0 0 15px rgba(0, 0, 0, 0.3); display: inline-block; width: 250px; text-align: center; transition: transform 0.5s ease, box-shadow 0.3s ease; transform-style: preserve-3d; }
            .product-card:hover { transform: rotateY(20deg) rotateX(10deg); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); }
            .product-card img { width: 100%; height: 150px; object-fit: cover; border-radius: 10px; }
            .product-card h3 { margin: 15px 0; font-size: 20px; }
            .product-card p { font-size: 18px; }
            .buy-button { padding: 12px 30px; background-color: #3498db; color: white; font-size: 18px; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s ease; }
            .buy-button:hover { background-color: #2980b9; }
            footer { text-align: center; background: #222; color: white; padding: 15px; position: fixed; width: 100%; bottom: 0; }
        </style>
    </head>
    <body>
    <header><h1>فروشگاه اکسسوری حرفه‌ای</h1></header>
    <div class="menu"><a href="#">خانه</a><a href="#">محصولات</a><a href="#">درباره ما</a><a href="#">تماس با ما</a></div>
    <div class="content"><h2>محصولات ویژه</h2><div class="product-container">';

    // نمایش محصولات
    foreach ($products as $product) {
        echo '<div class="product-card">
                <img src="'.$product['image_url'].'" alt="Product Image">
                <h3>'.$product['name'].'</h3>
                <p>'.number_format($product['price'], 2).' تومان</p>
                <button class="buy-button" onclick="window.location.href=\'/product.php?id='.$product['id'].'\'">خرید</button>
            </div>';
    }

    echo '</div></div><footer><p>تماس: 09199992134 | ایمیل: info@example.com</p><p>مدیریت: طاها یاری جو</p></footer></body></html>';
}

// صفحه محصول (product.php)
elseif ($_SERVER['REQUEST_URI'] == "/product.php") {
    $product_id = $_GET['id'];
    $stmt = $pdo->prepare("SELECT * FROM products WHERE id = :id");
    $stmt->execute(['id' => $product_id]);
    $product = $stmt->fetch(PDO::FETCH_ASSOC);

    echo '
    <!DOCTYPE html>
    <html lang="fa">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>جزئیات محصول</title>
        <link href="https://fonts.googleapis.com/css2?family=Shabnam&display=swap" rel="stylesheet">
        <style>
            body { font-family: "Shabnam", sans-serif; background: #111; color: white; margin: 0; padding: 0; }
            header { background: #222; color: white; padding: 20px; text-align: center; }
            .product-details { text-align: center; margin-top: 30px; }
            .product-details img { width: 300px; height: 300px; object-fit: cover; border-radius: 10px; }
            .buy-button { padding: 12px 30px; background-color: #3498db; color: white; font-size: 18px; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s ease; margin-top: 20px; }
            .buy-button:hover { background-color: #2980b9; }
            footer { text-align: center; background: #222; color: white; padding: 15px; position: fixed; width: 100%; bottom: 0; }
        </style>
    </head>
    <body>
    <header><h1>جزئیات محصول</h1></header>
    <div class="product-details">
        <img src="'.$product['image_url'].'" alt="Product Image">
        <h3>'.$product['name'].'</h3>
        <p>'.number_format($product['price'], 2).' تومان</p>
        <p>'.$product['description'].'</p>
        <button class="buy-button" onclick="window.location.href=\'/payment.php?id='.$product['id'].'\'">خرید</button>
    </div>
    <footer><p>تماس: 09199992134 | ایمیل: info@example.com</p><p>مدیریت: طاها یاری جو</p></footer></body></html>';
}

// صفحه پرداخت (payment.php)
elseif ($_SERVER['REQUEST_URI'] == "/payment.php") {
    $product_id = $_GET['id'];
    $stmt = $pdo->prepare("SELECT * FROM products WHERE id = :id");
    $stmt->execute(['id' => $product_id]);
    $product = $stmt->fetch(PDO::FETCH_ASSOC);

    echo '
    <!DOCTYPE html>
    <html lang="fa">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>پرداخت</title>
        <link href="https://fonts.googleapis.com/css2?family=Shabnam&display=swap" rel="stylesheet">
        <style>
            body { font-family: "Shabnam", sans-serif; background: #111; color: white; margin: 0; padding: 0; }
            header { background: #222; color: white; padding: 20px; text-align: center; }
            .payment-details { text-align: center; margin-top: 30px; }
            .buy-button { padding: 12px 30px; background-color: #3498db; color: white; font-size: 18px; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s ease; }
            .buy-button:hover { background-color: #2980b9; }
            footer { text-align: center; background: #222; color: white; padding: 15px; position: fixed; width: 100%; bottom: 0; }
        </style>
    </head>
    <body>
    <header><h1>پرداخت محصول</h1></header>
    <div class="payment-details">
        <h3>'.$product['name'].'</h3>
        <p>'.number_format($product['price'], 2).' تومان</p>
        <form method="POST" action="payment-gateway-link">
            <input type="hidden" name="amount" value="'.$product['price'].'">
            <input type="submit" value="پرداخت" class="buy-button">
        </form>
    </div>
    <footer><p>تماس: 09199992134 | ایمیل: info@example.com</p><p>مدیریت: طاها یاری جو</p></footer></body></html>';
}

// صفحه مدیریت (admin.php)
elseif ($_SERVER['REQUEST_URI'] == "/admin.php") {
    session_start();
    if (!isset($_SESSION['user_id'])) {
        header('Location: login.php');
        exit();
    }

    include('db.php');
    $stmt = $pdo->query("SELECT * FROM products");
    $products = $stmt->fetchAll(PDO::FETCH_ASSOC);

    echo '
    <!DOCTYPE html>
    <html lang="fa">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>پنل مدیریت</title>
        <style>
            body { font-family: "Shabnam", sans-serif; background: #111; color: white; margin: 0; padding: 0; }
            header { background: #222; color: white; padding: 20px; text-align: center; }
            .sidebar { width: 200px; background: #222; color: white; position: fixed; height: 100%; padding-top: 20px; }
            .sidebar a { display: block; padding: 15px; text-decoration: none; color: white; border-bottom: 1px solid #444; }
            .sidebar a:hover { background: #3498db; }
            .content { margin-left: 220px; padding: 20px; }
            .product-table { width: 100%; margin-top: 20px; border-collapse: collapse; }
            .product-table th, .product-table td { padding: 10px; text-align: center; border: 1px solid #444; }
            .product-table th { background-color: #3498db; }
            .btn { background-color: #3498db; color: white; padding: 8px 16px; text-decoration: none; border-radius: 5px; }
            footer { text-align: center; background: #222; color: white; padding: 15px; position: fixed; width: 100%; bottom: 0; }
        </style>
    </head>
    <body>
    <header><h1>پنل مدیریت</h1></header>
    <div class="sidebar">
        <a href="#">مدیریت محصولات</a>
        <a href="#">مدیریت سفارشات</a>
        <a href="#">خروج</a>
    </div>
    <div class="content">
        <h2>مدیریت محصولات</h2>
        <table class="product-table">
            <tr>
                <th>نام محصول</th>
                <th>قیمت</th>
                <th>عملیات</th>
            </tr>';
    
    foreach ($products as $product) {
        echo '<tr>
                <td>'.$product['name'].'</td>
                <td>'.number_format($product['price'], 2).' تومان</td>
                <td><a href="edit-product.php?id='.$product['id'].'" class="btn">ویرایش</a> <a href="delete-product.php?id='.$product['id'].'" class="btn">حذف</a></td>
            </tr>';
    }

    echo '</table></div><footer><p>تماس: 09199992134 | ایمیل: info@example.com</p><p>مدیریت: طاها یاری جو</p></footer></body></html>';
}
?>

